@using VonderkWEB.Models
@model HomeViewModel
@{
    ViewBag.Title = "AdminIndex";
}

<script>
    $(function () {

        $("#sortable2").sortable();
        $("#sortable2").disableSelection();
    });
</script>
<style>

    #sortable {
        list-style-type: none;
        margin: 0;
        padding: 0;
        width: 1000px;
    }

        #sortable li {
            margin: 3px 3px 3px 0;
            padding: 1px;
            float: left;
            width: 200px;
            font-size: 1em;
            text-align: center;
        }

            #sortable li.destacadoAdmin {
                width: 400px;
            }

            #sortable li span {
                position: absolute;
                margin-left: -1.3em;
            }


    .destacadoAdmin {
        height: 400px !important;
        grid-column-end: span 2;
        grid-row-end: span 2;
    }

        .destacadoAdmin img {
            height: 400px !important;
            width: 400px !important;
        }
</style>

<div class="content">

    <h2>Admin Productos</h2>
    <p>
        <span class="crear-nuevo-producto">
            @Html.ActionLink("Crear nuevo Producto", "Create")
        </span>
    </p>
    <table>
        <tr>
            <th>
                Categoria
            </th>
            <th>
                Marca
            </th>
            <th>
                Nombre
            </th>
            <th>
                Destacado
            </th>
            <th>
                Imagen
            </th>

            <th></th>
        </tr>
        @foreach (var item in Model.Products)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.Category.Name)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Brand.Name)
                </td>
                <td>

                    @Html.DisplayFor(modelItem => item.Name)
                </td>
                <td>
                    @if (item.IsOutstanding)
                    {<img src="~/Images/Icons/Outstanding.png" alt="Destacado" />}

                </td>

                <td>
                    @{
                        var p = item.ProductAssets.Where(x => x.AssetType == "IMG").OrderBy(d => d.SortOrder).FirstOrDefault();
                        if (p != null)
                        {
                            <img src="@p.FileName" alt="Photo" width="100" height="100" />
                        }
                    }
                    @*//<img src="/Images/ + item.CodProdCorregido + "/" + item.Imagen)" alt="Photo" width="100" height="100" />*@
                </td>

                <td>
                    @Html.ActionLink("Editar", "Edit", new { id = item.ProductID }) |
                    @Html.ActionLink("Ver", "Details", new { id = item.ProductID }) |
                    @Html.ActionLink("Eliminar", "Delete", new { id = item.ProductID })
                </td>
            </tr>
        }
    </table>

    <div class="demo">
        <h2>Arrastrar y soltar para cambiar el orden de la grilla</h2> <button type="button" onclick="display_array(true);">Re-ordenar Grilla!</button>
        <ul id="sortable">
            @*@foreach (var item in Model.Products.OrderBy(x => x.SortOrder))
                {
                    var p = item.ProductAssets.Where(x => x.AssetType == "IMG").OrderBy(d => d.SortOrder).FirstOrDefault();
                    if (p != null)
                    {
                        <li class="ui-state-default">
                <img src="@p.FileName" alt="Photo" width="100" height="100" class="img_class"> @Html.DisplayFor(modelItem => item.Name)
                </li>
                    }



                }*@
            @foreach (var item in Model.Products.OrderBy(x => x.SortOrder))
            {
                String destacado;
                if (item.IsOutstanding)
                {
                    destacado = "destacadoAdmin";
                }
                else { destacado = ""; };

                var p = item.ProductAssets.Where(x => x.AssetType == "IMG").OrderBy(d => d.SortOrder).FirstOrDefault();
                if (p != null)
                {
                    <li class="ui-state-default @(destacado) " data-id='@item.ProductID' >
                        <img src="@(p.FileName)" alt="Photo" width="200" height="200" class="img_class" /><span>@Html.DisplayFor(modelItem => item.Name)</span>

                    </li>


                }


            }
        </ul>



    </div><!-- End demo -->

</div>

<script>

    function display_array(showConfirmation) {



        //-------------step 1
        var $sortableList = $("#sortable");

        var sortEventHandler = function (event, ui) {


        };

        $sortableList.sortable({
            stop: sortEventHandler
        });

        // You can also set the event handler on an already existing Sortable widget this way:

        $sortableList.on("sortchange", sortEventHandler);

        //-------------step 2




        var listElements = $sortableList.children();



        var listValues = [];
        listElements.each(function (index, element) {
            listValues.push($(element).data('id'));
        });

        console.log(listValues); // [ "Item 1", "Item 2", ... ]

        //-------------step 3
        var serviceURL = '/Products/FirstAjax';

        $.ajax({
            type: "POST",
            url: serviceURL,
            data: { listValues: listValues },
            success: successFunc,
            error: errorFunc
        });



        function successFunc(data, status) {
            if (showConfirmation) {
                alert(data);
            }
            
        }

        function errorFunc() {
             alert('error');
            
           
        }

    }


    $(function () {

        display_array(false);

        //    //-------------step 1
        //    var $sortableList = $("#sortable");

        //    var sortEventHandler = function (event, ui) {
        //        console.log("New sort order!");

        //    };

        //    $sortableList.sortable({
        //        stop: sortEventHandler
        //    });

        //    // You can also set the event handler on an already existing Sortable widget this way:

        //    $sortableList.on("sortchange", sortEventHandler);

        //    //-------------step 2

        //    var listElements = $sortableList.children();
        //    console.log(listElements); // [ <li>, <li>, ... ]
        //    var listValues = [];

        //    listElements.each(function (index, element) {
        //        listValues.push(element.innerText);
        //    });

        //    console.log(listValues); // [ "Item 1", "Item 2", ... ]


        });



    

</script>